var modules=["BaseModule","HomeModule","CommunityModule","GeneralServiceModule","RestServiceModule","UploadServiceModule","AccountServiceModule"],app=angular.module("Perc",modules,["$interpolateProvider",function(a){a.startSymbol("<%"),a.endSymbol("%>")}]);app.directive("spinner",function(){return{restrict:"A",replace:!0,scope:{startSpinner:"=spin"},template:"<div></div>",link:function(a,b,c){var d={lines:13,length:20,width:10,radius:30,corners:1,rotate:0,direction:1,color:"#fff",speed:1,trail:60,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9},e=new Spinner(d);a.$watch("startSpinner",function(a){a?e.spin(b[0]):e.stop()})}}}),app.directive("knob",function(){return{restrict:"A",replace:!1,scope:{knobValue:"=time"},link:function(a,b,c){a.$watch("knobValue",function(a){b.knob({format:function(a){return a+" min"}}),b.val(a).trigger("change")})}}}),app.directive("sidebar",function(){return{restrict:"AE",replace:"true",templateUrl:"/site/angular/directives/sidebar.html"}}),app.filter("trusted",["$sce",function(a){return function(b){return a.trustAsResourceUrl(b)}}]),app.filter("youtubeEmbedUrl",["$sce",function(a){return function(b){return a.trustAsResourceUrl("http://www.youtube.com/embed/"+b)}}]);var accountService=angular.module("AccountServiceModule",["RestServiceModule"]);accountService.factory("accountService",["RestService",function(a){function b(a,b){var c=document.getElementById(b);c.style.border=a[b].length>0?"none":"1px solid red"}function c(a){var b=/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;return b.test(a)}var d={};return d.checkCurrentUser=function(b){console.log("ACCOUNT SERVICE: Check Current User "),a.get({resource:"currentuser",id:null},function(a){console.log("ACCOUNT SERVICE RESPONSE == "+JSON.stringify(a)),null!=b&&b(a)})},d.register=function(d,e){for(var f=[{firstName:"First Name"},{lastName:"Last Name"},{email:"Email"}],g=null,h=0;h<f.length;h++){var i=f[h],j=Object.keys(i)[0];if(0==d[j].length){b(d,j),g=i[j];break}}return null!=g?void(null!=e&&e(null,{message:"Missing "+g})):0==c(d.email)?void(null!=e&&e(null,{message:"Invalid Email"})):void a.post({resource:"profile",id:null},d,function(a){return console.log("ACCOUNT SERVICE RESPONSE == "+JSON.stringify(a)),"success"!=a.confirmation?void(null!=e&&e(null,{message:a.message})):void(null!=e&&e(a,null))})},d.updateProfile=function(b,c){a.update({resource:"profile",id:b.id},b,function(a){return console.log("ACCOUNT SERVICE RESPONSE == "+JSON.stringify(a)),"success"!=a.confirmation?void(null!=c&&c(null,{message:a.message})):void(null!=c&&c(a,null))})},d.login=function(b,d){return 0==b.email.length?void alert("Please enter your email"):0==b.password.length?void alert("Please enter your password"):0==c(b.email)?void alert("Please enter a valid email"):void a.post({resource:"login",id:null},b,function(a){return console.log("ACCOUNT SERVICE RESPONSE == "+JSON.stringify(a)),"success"!=a.confirmation?void(null!=d&&d(null,{message:a.message})):void(null!=d&&d(a,null))})},d}]);var generalService=angular.module("GeneralServiceModule",[]);generalService.factory("generalService",[function(){var a={};return a.truncatedText=function(a,b){return a.length<b?a:a.substring(0,b)+"..."},a.formattedDate=function(a){var b=moment(new Date(a)).format("MMM D, YYYY");return b},a.convertToLinks=function(a){var b;return b=/(\b(https?):\/\/[-A-Z0-9+&amp;@#\/%?=~_|!:,.;]*[-A-Z0-9+&amp;@#\/%=~_|])/gi,replacedText=a.replace(b,'<a class="colored-link-1" title="$1" href="$1" target="_blank">$1</a>'),replacePattern2=/(^|[^\/])(www\.[\S]+(\b|$))/gim,replacedText=replacedText.replace(replacePattern2,'$1<a class="colored-link-1" href="http://$2" target="_blank">$2</a>'),replacedText},a.parseLocation=function(a){var b=location.href.replace(window.location.origin,""),c={page:null,identifier:null,params:{}},d=b.split("?");if(d.length>1){for(var e=d[1],f=e.split("&"),g={},h=0;h<f.length;h++){var i=f[h].split("=");i.length<1||(g[i[0]]=i[1])}c.params=g}b=d[0];var j=b.split(a+"/");if(j.length>1)for(var k=j[1].split("/"),h=0;h<k.length;h++)0==h&&(c.page=k[h]),1==h&&(c.identifier=k[h]);return c},a}]);var restService=angular.module("RestServiceModule",["ngResource"]);restService.factory("RestService",["$resource",function(a){return a("/api/:resource/:id",{},{query:{method:"GET",params:{},isArray:!1},get:{method:"GET"},post:{method:"POST"},put:{method:"PUT"},update:{method:"PUT"}})}]);var stripeService=angular.module("StripeServiceModule",["ngResource"]);stripeService.factory("StripeService",["$resource",function(a){return a("/stripe/:resource/:id",{},{query:{method:"GET",params:{},isArray:!1},get:{method:"GET"},post:{method:"POST"},put:{method:"PUT"},update:{method:"PUT"}})}]);var uploadService=angular.module("UploadServiceModule",["angularFileUpload"]);uploadService.factory("uploadService",["$http","$upload",function(a,b){function c(a,c,d,e){for(var f=0;f<a.length;f++){var g=a[f];b.upload({url:c,method:"POST",file:g}).progress(function(a){console.log("percent: "+parseInt(100*a.loaded/a.total))}).success(function(a,b,c,d){var f=a.confirmation;return"success"!=f?void(null!=e&&e(null,{message:a.message})):void(null!=e&&e(a,null))})}}var d={};return d.uploadFiles=function(b,d){console.log("UPLOAD SERVICE: Upload "+b.files.length+" Files - "+JSON.stringify(b));var e="https://media-service.appspot.com/api/upload?media="+b.media;a.get(e).success(function(a,e,f,g){return console.log("DATA : "+JSON.stringify(a)),"success"!=a.confirmation?void(null!=d&&d(null,{message:a.message})):void c(b.files,a.upload,b.media,d)}).error(function(a,b,c,e){console.log("error",a,b,c,e),null!=d&&d(null,{message:a})})},d}]);var baseCtr=angular.module("BaseModule",[]);baseCtr.controller("BaseController",["$scope","accountService","generalService","uploadService","RestService",function(a,b,c,d,e){a.generalService=c,a.profile=null,a.credentials={email:"",password:"",name:""},a.loading=!1,a.register=function(){a.loading=!0,b.register(a.profile,function(b,c){return null!=c?(a.loading=!1,void alert(c.message)):void(window.location.href="/site/account")})},a.login=function(){a.loading=!0,b.login(a.credentials,function(b,c){return null!=c?(a.loading=!1,void alert(c.message)):void(window.location.href="/site/forum")})}}]);var communityCtr=angular.module("CommunityModule",[]);communityCtr.controller("CommunityController",["$scope","accountService","generalService","uploadService","RestService",function(a,b,c,d,e){function f(){e.query({resource:"community"},function(a){"success"==a.confirmation&&console.log("Communities == "+JSON.stringify(a))})}a.community={name:"",website:"",description:"",url:"",image:"",password:""},a.init=function(){console.log("CommunityController: INIT"),b.checkCurrentUser(function(b){"success"==b.confirmation&&(a.profile=b.profile),f()})},a.createCommunity=function(){console.log("create community called:"+JSON.stringify(a.community)),e.post({resource:"community"},a.community,function(a){"success"!=a.confirmation&&alert("post request failed")})},a.onFileSelect=function(b,c,e){d.uploadFiles({files:b,media:e},function(b,c){if(null!=c)return void alert(c.message);if("images"==e){var d=b.image;console.log(JSON.stringify(d)),a.community.image=d.id,console.log(a.community)}})}}]);var homeCtr=angular.module("HomeModule",[]);homeCtr.controller("HomeController",["$scope","accountService","generalService","uploadService","RestService",function(a,b,c,d,e){function f(){e.query({resource:"post",id:null,limit:"0"},function(a){"success"==a.confirmation&&console.log("RECENT POSTS == "+JSON.stringify(a))})}a.init=function(){console.log("HomeController: INIT"),b.checkCurrentUser(function(b){"success"==b.confirmation&&(a.profile=b.profile),f()})}}]);